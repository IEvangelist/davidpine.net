+++
author = "David Pine"
categories = ["WebAssembly", "WASM", "Blazor", "CSharp"]
date = "2022-09-08"
description = "C# Source Generator for JavaScript Interop in Blazor"
images = ["/img/2022/09/blazorators.png"]
featured = "blazorators.png"
featuredalt = "The Blazorators logo"
featuredpath = "img/2022/09"
linktitle = "Blazorators: A C# Source Generator for JavaScript Interop in Blazor"
title = "Blazorators"
type = "post"
+++

# Blazorators

_Blazorators_ is a C# source generator that creates fully functioning Blazor JavaScript interop code, targeting either the `IJSInProcessRuntime` or `IJSRuntime` types. All of this code relies on the output of [one of my side projects named `blazorators`](https://github.com/IEvangelist/blazorators). While writing [my O'Reilly "Learning Blazor: Build Single-Page Apps with WebAssembly and C#" book](../learning-blazor), I discovered an impactful way to use both TypeScript type declarations from common JavaScript APIs and C# source generators to generate the JavaScript interop code. This is covered in chapter seven, so I don't want to spoil it too much, but rather entice you to want to [read the book](../learning-blazor). I've been using this approach in my Blazor apps for a while now and I'm excited to share it with you. Let's get started!

Check out my new [{{< i "fa-twitter" >}} Twitter account (@blazorbits)](twitter.com/@blazorbits) for Blazor tips and tricks! Below you'll see the Progress Telerik REPL (Read Evaluate Print Loop) for Blazor, select the **Preview** tab and watch the Blazor WebAssembly app perform a .NET restore and builds the app. Once the app loads, select a Natural voice from the voice selection control if it is available to you. If it's not available to you, that's not a big deal either. Select the **Speak** button and the app will speak the text you entered in the **Text-to-speech** control. You can also select the **Stop** button to stop the speech.

{{< blazor-repl id="mcajYsly289d8oAd18" >}}

## Explore the app source code

when you create your own REPL session you're free to consume public NuGet packages, this app uses the [`Blazor.SpeechSynthesis.WebAssembly`](https://www.nuget.org/packages/Blazor.SpeechSynthesis.WebAssembly) NuGet package üì¶.
Explore the **Code** tab thoroughly and look through the app's source code. You'll see that this app does the following:

- __Main.razor_: The app's main page, that showing a loading indicator and immediately navigates to the **/speak** route.
- _TextToSpeech.razor_: The page that renders the **Text-to-speech** text input element and the [browser-native speech synthesis](https://developer.mozilla.org/en-US/docs/Web/API/Window/speechSynthesis) control buttons.
- _TextToSpeech.razor.cs_: The page's code-behind that contains the `TextToSpeech` component's logic.
- _Startup.cs_: The app's startup class that configures services, calling a source-generated dependency injection specific extension method named `AddSpeechServices.

Notice the `SpeechSynthesisVoice[]`, `SpeechSynthesisUtterance`, and `ISpeechSynthesisService` types. These are all from the `Blazor.SpeechSynthesis.WebAssembly` NuGet package üì¶. The `SpeechSynthesisVoice[]` type is an array of `SpeechSynthesisVoice` objects that represent the available voices on the user's device. The `SpeechSynthesisUtterance` type is a class that represents the text to be spoken and the voice to be used. The `ISpeechSynthesisService` type is an interface that defines the `GetVoicesAsync` and an in-process `Speak` method that is synchronous.

The `Speak` function takes a `SpeechSynthesisUtterance` object and a callback function that is invoked when the speech is complete, delivering the total elapsed time in milliseconds.

There is also a way to listen for changes in the browser-native `window.speechSynthesis` voices that are available to the JavaScript context. Provide a callback to the `ISpeechSynthesisService.OnVoicesChanged` event and it will be invoked when the `window.speechSynthesis` `voiceschanged` event is fired. This is useful if you want to update the UI with the available voices. All of this functionality is source-generated by the `Blazor.SourceGenerator` project.

## What's next?

This project was originally written as part of a Microsoft hackathon. It's been refined, but is still a brute-force effort and could stand to be optimized. As such I'm working to reimplement the parsing approach. It currently makes an HTTP request to a raw Github link with the _lib.dom.d.ts_ file with all of the DOM type declarations in it. The file is itself, generated, and is over 18 thousand lines of code. It uses `Regex` expressions to parse on-demand single hierarchical type dependency graphs as `readonly record struct` values. These values were modeled as  

## Patent pending, not... ‚òπÔ∏è

I was working with Stephen Toub (the patent lead for the .NET team), and we filed it for a patent. I was disappointed to learn that it wasn't filed as the lawyers reviewed it and determined that it wasn't patentable. I'm not sure why, but I'm glad to share it with you. I hope you find it useful. If you have any questions, please feel free to reach out to me:

- {{< i "fa-twitter" >}} [Follow me on Twitter](https://twitter.com/davidpine7)
- {{< i "fa-github" >}} [GitHub profile](https://github.com/IEvangelist)
- {{< i "fa-github-alt" >}} [Blazorators repository](https://github.com/IEvangelist/blazorators)

The community is excited about this project, and I'm excited to see what you build with it. Here's what some of the community members have said on Twitter:

{{< x user="robertmclaws" id="1510292205814095874" >}}

{{< x user="KStrubeG" id="1503140307537440783" >}}

{{< x user="Scott_Addie" id="1507350467524841474" >}}

{{< x user="EdCharbeneau" id="1504161891756748800" >}}

### The plan

I'm rewriting the TypeScript abstract syntax tree parser to C#, essentially porting it one-to-one. When this is done, the parsing will be much more accurate and flexible. Likewise, our friends over on Twitter, and some of the community members on YouTube have been kind to me as well. Thank you for your kind words, they mean the world to me.

{{< yt-comment href="https://www.youtube.com/watch?v=U8XriF2zxS0&lc=UgyWLpFDYjI048tcnit4AaABAg" name="fieryscorpion" >}}
This is a pretty amazing project. Hope this makes it into a serious project at Microsoft!
Thank you!
{{</ yt-comment >}}

{{< yt-comment href="https://www.youtube.com/watch?v=U8XriF2zxS0&lc=UgzpOMTAz_KatcVURjV4AaABAg" name="Ji≈ô√≠ Novotn√Ω"  >}}
I think this package has a lot of potential. It makes the bridge between JS and C# in Blazor much less painful. I love it! Well done, David.
{{</ yt-comment >}}

## Additional resources

{{< youtube U8XriF2zxS0 >}}

&nbsp;

{{< youtube RGPS0y2pl2k >}}

&nbsp;
